#!/bin/bash
BASH_PATH=/tmp/Hais/ReplaceFile

#删除多余文件
busybox rm -rf /system_root/lost+found
busybox rm -rf /cache/lost+found
busybox rm -rf /data/lost+found
busybox rm -rf /data/magisk_backup_*
busybox rm -rf /mnt/vendor/persist/lost+found


#替换system所有文件
repType=system
for file in `find $BASH_PATH/${repType}_files/* -type f`
	do
		tmpPath=${file%/*}									#刷机包中的路径
		sysfile=${repType}${file##*${repType}_files}	#准备要替换或增加的目标文件
		sysPath=${sysfile%/*}					#准备要替换或增加的文件
		echo "- 备份并替换 $file"
		echo "mkdir -p /$sysPath"
		echo "cp  $file /$sysfile"
		echo "chmod 644 /$sysfile"
		mkdir -p /$sysPath					#创建目标目录 /system/app/Via/
		cp  $file /$sysfile					#替换文件
		chmod 644 /$sysfile					#修复权限
	done
	

#替换vendor所有文件
repType=vendor
for file in `find $BASH_PATH/${repType}_files/* -type f`
	do
		tmpPath=${file%/*}									#刷机包中的路径
		sysfile=${repType}${file##*${repType}_files}	#准备要替换或增加的目标文件
		sysPath=${sysfile%/*}					#准备要替换或增加的文件
		echo "- 备份并替换 $file"
		echo "mkdir -p /$sysPath"
		echo "cp  $file /$sysfile"
		echo "chmod 644 /$sysfile"
		mkdir -p /$sysPath					#创建目标目录 /system/app/Via/
		cp  $file /$sysfile					#替换文件
		chmod 644 /$sysfile					#修复权限
	done
	
	

#替换cust所有文件
repType=cust
for file in `find $BASH_PATH/${repType}_files/* -type f`
	do
		tmpPath=${file%/*}									#刷机包中的路径
		sysfile=${repType}${file##*${repType}_files}	#准备要替换或增加的目标文件
		sysPath=${sysfile%/*}					#准备要替换或增加的文件
		echo "- 备份并替换 $file"
		echo "mkdir -p /$sysPath"
		echo "cp  $file /$sysfile"
		echo "chmod 644 /$sysfile"
		mkdir -p /$sysPath					#创建目标目录 /system/app/Via/
		cp  $file /$sysfile					#替换文件
		chmod 644 /$sysfile					#修复权限
	done
	

#替换data所有文件
repType=data
for file in `find $BASH_PATH/${repType}_files/* -type f`
	do
		tmpPath=${file%/*}									#刷机包中的路径
		sysfile=${repType}${file##*${repType}_files}	#准备要替换或增加的目标文件
		sysPath=${sysfile%/*}					#准备要替换或增加的文件
		echo "- 备份并替换 $file"
		echo "mkdir -p /$sysPath"
		echo "cp  $file /$sysfile"
		echo "chmod 644 /$sysfile"
		mkdir -p /$sysPath					#创建目标目录 /system/app/Via/
		cp  $file /$sysfile					#替换文件
		chmod 644 /$sysfile					#修复权限
	done
	
	
echo "关闭桌面日记"
home=/data/user_de/0/com.miui.home/cache/debug_log
busybox chattr -i $home
rm -rf $home
mkdir -p $home
#chmod 000 $home
#busybox chattr +i $home	#不可读会导致界面不可保存


#增加相机内测功能
touch /sdcard/DCIM/Camera/lab_options_visible

#去除安全中心广告
rm -rf /data/data/com.miui.securitycenter/files/securityscan_homelist_cache
touch /data/data/com.miui.securitycenter/files/securityscan_homelist_cache
busybox chmod 000 /data/data/com.miui.securitycenter/files/securityscan_homelist_cache

#去除 抖音广告
rm -rf /storage/emulated/0/Android/data/com.ss.android.ugc.aweme/splashCache
touch /storage/emulated/0/Android/data/com.ss.android.ugc.aweme/splashCache
busybox chmod 000 /storage/emulated/0/Android/data/com.ss.android.ugc.aweme/splashCache

#去除 网易云广告
rm -rf /storage/emulated/0/Android/data/com.netease.cloudmusic/cache/ad
touch /storage/emulated/0/Android/data/com.netease.cloudmusic/cache/ad
busybox chmod 000 /storage/emulated/0/Android/data/com.netease.cloudmusic/cache/ad

#去除 咸鱼开屏广告
rm -rf /storage/emulated/0/Android/data/com.taobao.idlefish/files/ad
touch /storage/emulated/0/Android/data/com.taobao.idlefish/files/ad
busybox chmod 000 /storage/emulated/0/Android/data/com.taobao.idlefish/files/ad


#调用自定义apk文件
haisConfig='/sdcard/HaisConfig.sh'
if [ -e "$haisConfig" ];then 
	echo "启用自定义扩展"
	rm -rf "/tmp/mHaisExtended.log"
	busybox sh $haisConfig | tee -a "/tmp/mHaisExtended.log"	#运行扩展脚本
else
	#默认删除编译
	busybox rm -rf /data/dalvik-cache
	busybox rm -rf /data/system/package_cache
fi
